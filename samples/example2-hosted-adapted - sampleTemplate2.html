<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link type="text/css" href="http://rdforms.com/release/dijit/themes/claro/claro.css" rel="stylesheet" />
    <link type="text/css" href="http://rdforms.com/release/rdforms/view/resources/rdforms.css" rel="stylesheet" />
    <link rel="stylesheet" type="text/css" href="../css/cpsv.css">
    <script src="../release/dojo/dojo.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="download.js"></script>
</head>


<body class="claro">

<script type="text/javascript">
    require([
        'rdfjson/Graph',             //Rdfjson Graph API
        'rdforms/template/ItemStore', //Stores all the RDForm templates
        'rdforms/apps/Experiment',        //The editor User interface
        'dojo/json',
        'dojo/text!./emptyRDF.json',
        'dojo/text!./sampleTemplate2.json',
        'dojo/domReady!'             //Wait until the dom is ready.
    ], function(Graph, ItemStore, Experiment, json, emptyRDF, sampleTemplate2) {
        /*Setup the editor.
        Create the graph, itemstore and templatebundle
        Create a new experiment inside the container div and start it*/
        var graph = new Graph(json.parse(emptyRDF));
        var itemStore = new ItemStore();
        var bundle = itemStore.registerBundle({source: json.parse(sampleTemplate2)});
        var e = new Experiment({
            graph: graph,
            template: bundle.getRoot(),
            hideTemplate: true
        }, "body");
        e.startup();


        /*Append a download button to the ribbon in the RDF tab and add the onclick functionality to it*/
        /*Append a button to the ribbon in the RDF tab*/
        var node = document.getElementById("dijit_layout_TabContainer_1_tablist");
        var btn = document.createElement('button');
        btn.textContent = "download";
        node.appendChild(btn);
        var buttons = node.getElementsByTagName("BUTTON");


        /*Add the onlick event. Download the text to a local file.*/
        buttons[0].onclick = function(){

            /*Get the value of the active text field*/
            var activeTextField = $(".dijitTabPaneWrapper.dijitTabContainerTop-container.dijitTabPaneWrapperNested.dijitAlignCenter .dijitTabContainerTopChildWrapper.dijitVisible textarea").attr('id');
            var textEditorFormat = dijit.byId(activeTextField).value;
            /*var textXML = dijit.byId("dijit_form_SimpleTextarea_1").value;
            var textJSON = dijit.byId("dijit_form_SimpleTextarea_2").value;*/

            var textRDFFormat = null;
            if (activeTextField == "dijit_form_SimpleTextarea_1") {
                textRDFFormat = transformRDFXML(textEditorFormat);
                download('PublicServiceDescriptionRDFXML.xml', textRDFFormat);
                download('PublicServiceDescriptionEditorFormatRDFXML.xml', textEditorFormat);
            } else {
                textRDFFormat = transformRDFJSON(textEditorFormat);
                download('PublicServiceDescriptionRDFJSON.xml', textRDFFormat);
                download('PublicServiceDescriptionEditorFormatRDFJSON.xml', textEditorFormat);
            }
              
        };

    });
    
    function opentab(evt, tabname){
    	var i, tabcontent, tablinks;
    	
    	tabcontent = document.getElementsByClassName("tabcontent");
    		for (i = 0; i < tabcontent.length; i++) {
    			tabcontent[i].style.display = "none";
    		}
    		
    	tablinks = document.getElementsByClassName("tablinks");
    		for (i = 0; i < tablinks.length; i++) {
    			tablinks[i].className = tablinks[i].className.replace(" active", "");
    		}
    		
    	document.getElementById(tabname).style.display = "block";
    		evt.currentTarget.className += " active";
    }
</script>


    <div class="container">
        <header class="banner">
        	  <a id="logobanner" href="#"><img src="../images/CPSV-AP_logo.png" width="100" height="100" float = "left" alt="CPSV-AP logo" /></a>
        	  <h1 id = "maintitle"> Public Service Describer </h1>
   
        </header>
         <div class= "tab">
        	<button class="tablinks" onclick="opentab(event, 'editor')">Editor</button>
 			<button class="tablinks" onclick="opentab(event, 'about')">About</button>
 		</div>
 		
        <div id= "about" class= "tabcontent" display: "none">
        <h1> Public Service Describer </h1>
        <p> This editor was made by Carmen and it's very cool. It creates public service descriptions. </p>   
        <p> Instructions to install this editor on your local computer can be found on the following github page: 
        <a href= https://github.com/catalogue-of-services-isa/cpsv-ap_rdf_editor> https://github.com/catalogue-of-services-isa/cpsv-ap_rdf_editor</a> </p>
        </div>
      		
 		<div id= "editor" class= "tabcontent">
        <div class="body" id="body"></div>
        </div>
        
        <footer>
                <a href="http://ec.europa.eu/"><img src="../images/logo_commission.png" width="172" height="119" alt="European Commission"/></a>
                <p>
                    <small>Public service describer: Copyright ©  European Union 2016. This validator is published under the <a href="https://joinup.ec.europa.eu/community/eupl/home">EUPL v1.1 licence</a><br/>
                    This project is funded by <a href="https://ec.europa.eu/isa2/actions/accessing-member-state-information-resources-european-level_en">ISA2 Action 2016.29</a> under framework contract DI/07171 Lot 2 (Specific Contract 270).<br/>
                    Authors: Carmen Vandeloo (Based on the work done).<br/>
                    Apache Fuseki is a copyright © 2011-2015 of the Apache Software Foundation, licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, Version 2.0</a>.<br/>
                    </small>
                </p>
        </footer>
    </div>
</body>
</html>